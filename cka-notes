Note : 
Set auto-completion for aliases
complete -p YOUR_CMD # find the command fucntion
complete -F YOUR_CMD_FUNCTION kubectl # set this in bashrc

WARNING : FAIRE UN FOCUS SUR 
- LES API-GATEWAY
- LES STRATEGY DANS LES DEPLOYMENT

## RBAC :
Subject: The user or process that wants to access a resource.
Resource: The Kubernetes API resource type e.g. a Deployment or node.
Verb: The operation that can be ex
kubectl create role <name> --verb=<verbs> --resource=<resources> -n <ns>
kubectl create rolebinding <name> --role=<role> --user=<user> -n <ns>
kubectl create clusterrole ...
kubectl create clusterrolebinding ...
kubectl auth can-i <verb> <resource> --as <user>


# create a user in k8s : https://kubernetes.io/docs/tasks/tls/certificate-issue-client-csr
# change the default ns
kubectl config set-context --current --namespace=NAMESPACE

# YAML syntax
microservice : #objet
  app : auth # key : value
  port : 300
  version : 1.7

# In case of list :

microservice :
  - app : auth
    port : 300
    version : 1.7
  - app: user
    port : 3009
    version : 1.8

# paste un multiline dans un yaml file
mylines: |
   line 1
   line 2
   line 3

Exemple executer un script 
command: 
   - sh
   - -C 
   - |
    Paste all 
    Your script 

#Paste a long sentence in  yaml
mylongsentence: >
    Mariame joue
    a la balle 
    avec bile 
    son ami

# check permission
kubectl auth can-i --list --as johndoe
kubectl auth can-i list pods --as johndoe

# Update iptables config
cat <<EOF > /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF
sudo sysctl --system

# Backup and restore ETCD
### Backup
ETCDCTL_API=3 etcdctl --endpoints=https://127.0.0.1:2379 \
  --cacert=<trusted-ca-file> --cert=<cert-file> --key=<key-file> \
  snapshot save <backup-file-location>

Exemple : 
ETCDCTL_API=3 etcdctl --endpoints=https://127.0.0.1:2379 \
  --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key \
  snapshot save /tmp/snapshot.db

#### Restore
export ETCDCTL_API=3
etcdctl --data-dir <data-dir-location> snapshot restore snapshot.db

Now edit /etc/kubernetes/manifests/etcd.yaml and change **volumes.hostPath.path** for name: etcd-data to <data-dir-location>,
then execute kubectl -n kube-system delete pod <name-of-etcd-pod> or systemctl restart kubelet.service or both

# Determine the api-server endpoint
kubectl config view --minify -o jsonpath='{.clusters[0].cluster.server}'

# Get the Secret access token of a ServiceAccount
kubectl get secret $(kubectl get serviceaccount api-access -n apps \
 -o jsonpath='{.secrets[0].name}') -o jsonpath='{.data.token}' -n apps \
 | base64 --decode

# Curl for listing pods in ns rm from a pod
curl https://10.10.10.38:6443/api/v1/namespaces/rm/pods --header --insecure

#  Rolling Updates and Rollbacks 
